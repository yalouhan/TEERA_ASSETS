import matplotlib.pyplot as plt
from tslearn.clustering import KShape
from tslearn.preprocessing import TimeSeriesScalerMeanVariance
from tslearn.utils import to_time_series_dataset

def load_data(file_name):
    sequences = []
    with open(file_name, 'r') as file:
        for line in file:
            parts = line.strip().split(',')
            sequence = [float(i) for i in parts[:-1]]  # 忽略布尔值
            if len(sequence) >= 4000:
                sequences.append(sequence[-4000:])
            else:
                sequences.append(sequence)
    return sequences

sequences = load_data('data_file_HYL.txt')
sequences = to_time_series_dataset(sequences)
sequences = TimeSeriesScalerMeanVariance().fit_transform(sequences)


n_clusters = 2
ks = KShape(n_clusters=n_clusters, verbose=True, random_state=0)
y_pred = ks.fit_predict(sequences)

plt.figure()
for yi in range(n_clusters):
    plt.subplot(3, 1, 1 + yi)
    for xx in sequences[y_pred == yi]:
        plt.plot(xx.ravel(), "k-", alpha=.2)
    plt.plot(ks.cluster_centers_[yi].ravel(), "r-")
    plt.xlim(0, len(sequences[0]))
    plt.ylim(-4, 4)
    plt.title(f"Cluster {yi + 1}")

plt.tight_layout()
plt.show()
